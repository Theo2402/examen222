{"ast":null,"code":"import React,{useState,useEffect}from'react';import axios from'axios';import'../css/MainPage.css';import checkmark from'../animations/icons8-checkmark.gif';import{HeaderBase,FooterBase}from'./HeaderFooter.js';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const getTotalQuantity=()=>{const cart=JSON.parse(localStorage.getItem('cart'))||[];return cart.reduce((acc,item)=>acc+item.quantity,0);};const MainPage=()=>{const[offers,setOffers]=useState([]);const[quantities,setQuantities]=useState([]);const[showPopup,setShowPopup]=useState(false);const[totalQuantity,setTotalQuantity]=useState(getTotalQuantity());useEffect(()=>{const fetchOffers=async()=>{try{const response=await axios.get('http://127.0.0.1:8000/api/offer/');setOffers(response.data);setQuantities(response.data.map(()=>0));}catch(error){console.error('Failed to fetch offers:',error);}};fetchOffers();},[]);const addToCart=offerIndex=>{const offer=offers[offerIndex];let cart=JSON.parse(localStorage.getItem('cart'))||[];let itemIndex=cart.findIndex(item=>item.id===offer.id);if(itemIndex!==-1){cart[itemIndex].quantity+=quantities[offerIndex];}else{cart.push({...offer,quantity:quantities[offerIndex]});}localStorage.setItem('cart',JSON.stringify(cart));setShowPopup(true);setTotalQuantity(getTotalQuantity());setTimeout(()=>{setShowPopup(false);},3000);};const handleQuantityChange=(offerIndex,newQuantity)=>{newQuantity=Math.min(Math.max(newQuantity,0),1);setQuantities(prevQuantities=>{const newQuantities=[...prevQuantities];newQuantities[offerIndex]=newQuantity;return newQuantities;});};//const calculateSavingsPercentage = (price, savings) => {\n// return Math.round((savings / price) * 100);\n//};\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"mainpage-background\",children:[/*#__PURE__*/_jsx(HeaderBase,{totalQuantity:totalQuantity,currentPage:\"offre\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"offer-section\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"offer-title\",children:\"Les Offres :\"}),/*#__PURE__*/_jsx(\"div\",{className:\"offer-container\",children:offers.map((offer,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"offer-card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"offer-card-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"offer-title-description\",children:[/*#__PURE__*/_jsx(\"h3\",{children:offer.title}),/*#__PURE__*/_jsx(\"p\",{className:\"offer-description\",children:offer.description})]}),/*#__PURE__*/_jsx(\"div\",{className:\"offer-divider\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"offer-price-quantity\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"offer-price\",children:[parseFloat(offer.price).toFixed(2),\"\\u20AC\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"quantity-controls-wrapper\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"subtract\",onClick:()=>handleQuantityChange(index,quantities[index]-1),children:\"-\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:quantities[index],onChange:e=>handleQuantityChange(index,parseInt(e.target.value))}),/*#__PURE__*/_jsx(\"button\",{className:\"add\",onClick:()=>handleQuantityChange(index,quantities[index]+1),children:\"+\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"add-to-basket\",onClick:()=>addToCart(index),disabled:quantities[index]===0,children:\"Ajouter Panier\"})]})]})},offer.id))}),showPopup&&/*#__PURE__*/_jsx(Popup,{message:\"Item successfully added to your basket\"})]}),/*#__PURE__*/_jsx(FooterBase,{})]});};const Popup=_ref=>{let{message}=_ref;useEffect(()=>{const icon=document.querySelector('.animation-icon');icon.classList.add('animate');setTimeout(()=>{icon.classList.remove('animate');},1000);return()=>{icon.classList.remove('animate');};},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"popup\",children:[/*#__PURE__*/_jsx(\"p\",{children:message}),/*#__PURE__*/_jsx(\"img\",{src:checkmark,alt:\"Animation\",className:\"animation-icon\",style:{animationDuration:'1s'}})]});};export default MainPage;","map":{"version":3,"names":["React","useState","useEffect","axios","checkmark","HeaderBase","FooterBase","jsx","_jsx","jsxs","_jsxs","getTotalQuantity","cart","JSON","parse","localStorage","getItem","reduce","acc","item","quantity","MainPage","offers","setOffers","quantities","setQuantities","showPopup","setShowPopup","totalQuantity","setTotalQuantity","fetchOffers","response","get","data","map","error","console","addToCart","offerIndex","offer","itemIndex","findIndex","id","push","setItem","stringify","setTimeout","handleQuantityChange","newQuantity","Math","min","max","prevQuantities","newQuantities","className","children","currentPage","index","title","description","parseFloat","price","toFixed","onClick","type","value","onChange","e","parseInt","target","disabled","Popup","message","_ref","icon","document","querySelector","classList","add","remove","src","alt","style","animationDuration"],"sources":["/Users/theodiloreto/Desktop/examen 2 2 2/jo/src/components/MainPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport '../css/MainPage.css';\nimport checkmark from '../animations/icons8-checkmark.gif';\nimport { HeaderBase, FooterBase } from './HeaderFooter.js';\n\n\nconst getTotalQuantity = () => {\n  const cart = JSON.parse(localStorage.getItem('cart')) || [];\n  return cart.reduce((acc, item) => acc + item.quantity, 0);\n};\n\nconst MainPage = () => {\n  const [offers, setOffers] = useState([]);\n  const [quantities, setQuantities] = useState([]); \n  const [showPopup, setShowPopup] = useState(false); \n  const [totalQuantity, setTotalQuantity] = useState(getTotalQuantity());\n\n  useEffect(() => {\n    const fetchOffers = async () => {\n      try {\n        const response = await axios.get('http://127.0.0.1:8000/api/offer/');\n        setOffers(response.data);\n        setQuantities(response.data.map(() => 0)); \n      } catch (error) {\n        console.error('Failed to fetch offers:', error);\n      }\n    };\n\n    fetchOffers();\n  }, []);\n\n  const addToCart = (offerIndex) => {\n    const offer = offers[offerIndex];\n    let cart = JSON.parse(localStorage.getItem('cart')) || [];\n    let itemIndex = cart.findIndex(item => item.id === offer.id);\n\n    if (itemIndex !== -1) {\n      cart[itemIndex].quantity += quantities[offerIndex];\n    } else {\n      cart.push({ ...offer, quantity: quantities[offerIndex] });\n    }\n\n    localStorage.setItem('cart', JSON.stringify(cart));\n    setShowPopup(true); \n    setTotalQuantity(getTotalQuantity()); \n    setTimeout(() => {\n    setShowPopup(false); \n    }, 3000);\n  };\n\n  const handleQuantityChange = (offerIndex, newQuantity) => {\n    \n    newQuantity = Math.min(Math.max(newQuantity, 0), 1);\n\n    \n    setQuantities(prevQuantities => {\n      const newQuantities = [...prevQuantities];\n      newQuantities[offerIndex] = newQuantity;\n      return newQuantities;\n    });\n  };\n\n  //const calculateSavingsPercentage = (price, savings) => {\n   // return Math.round((savings / price) * 100);\n  //};\n\n  return (\n    <div className=\"mainpage-background\">\n      <HeaderBase totalQuantity={totalQuantity} currentPage=\"offre\" /> \n      <div className=\"offer-section\">\n        <h1 className=\"offer-title\">Les Offres :</h1>\n        <div className=\"offer-container\">\n          {offers.map((offer, index) => (\n            <div className=\"offer-card\" key={offer.id}>\n              <div className=\"offer-card-content\">\n                <div className=\"offer-title-description\">\n                  <h3>{offer.title}</h3>\n                  <p className=\"offer-description\">{offer.description}</p>\n                </div>\n                <div className=\"offer-divider\"></div>\n                <div className=\"offer-price-quantity\">\n                  <p className=\"offer-price\">{parseFloat(offer.price).toFixed(2)}â‚¬</p>\n                  <div className=\"quantity-controls-wrapper\">\n                    <button className=\"subtract\" onClick={() => handleQuantityChange(index, quantities[index] - 1)}>-</button>\n                    <input\n                      type=\"number\"\n                      value={quantities[index]}\n                      onChange={(e) => handleQuantityChange(index, parseInt(e.target.value))}\n                    />\n                    <button className=\"add\" onClick={() => handleQuantityChange(index, quantities[index] + 1)}>+</button>\n                  </div>\n                  <button className=\"add-to-basket\" onClick={() => addToCart(index)} disabled={quantities[index] === 0}>Ajouter Panier</button>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n        {showPopup && <Popup message=\"Item successfully added to your basket\" />}\n      </div>\n      <FooterBase />\n    </div>\n  );\n};\n\nconst Popup = ({ message }) => {\n  useEffect(() => {\n    const icon = document.querySelector('.animation-icon');\n    icon.classList.add('animate');\n\n    setTimeout(() => {\n      icon.classList.remove('animate');\n    }, 1000);\n\n    return () => {\n      icon.classList.remove('animate');\n    };\n  }, []);\n\n  return (\n    <div className=\"popup\">\n      <p>{message}</p>\n      <img\n        src={checkmark}\n        alt=\"Animation\"\n        className=\"animation-icon\"\n        style={{ animationDuration: '1s' }}\n      />\n    </div>\n  );\n};\n\nexport default MainPage;\n\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,qBAAqB,CAC5B,MAAO,CAAAC,SAAS,KAAM,oCAAoC,CAC1D,OAASC,UAAU,CAAEC,UAAU,KAAQ,mBAAmB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAG3D,KAAM,CAAAC,gBAAgB,CAAGA,CAAA,GAAM,CAC7B,KAAM,CAAAC,IAAI,CAAGC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,EAAI,EAAE,CAC3D,MAAO,CAAAJ,IAAI,CAACK,MAAM,CAAC,CAACC,GAAG,CAAEC,IAAI,GAAKD,GAAG,CAAGC,IAAI,CAACC,QAAQ,CAAE,CAAC,CAAC,CAC3D,CAAC,CAED,KAAM,CAAAC,QAAQ,CAAGA,CAAA,GAAM,CACrB,KAAM,CAACC,MAAM,CAAEC,SAAS,CAAC,CAAGtB,QAAQ,CAAC,EAAE,CAAC,CACxC,KAAM,CAACuB,UAAU,CAAEC,aAAa,CAAC,CAAGxB,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAACyB,SAAS,CAAEC,YAAY,CAAC,CAAG1B,QAAQ,CAAC,KAAK,CAAC,CACjD,KAAM,CAAC2B,aAAa,CAAEC,gBAAgB,CAAC,CAAG5B,QAAQ,CAACU,gBAAgB,CAAC,CAAC,CAAC,CAEtET,SAAS,CAAC,IAAM,CACd,KAAM,CAAA4B,WAAW,CAAG,KAAAA,CAAA,GAAY,CAC9B,GAAI,CACF,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAA5B,KAAK,CAAC6B,GAAG,CAAC,kCAAkC,CAAC,CACpET,SAAS,CAACQ,QAAQ,CAACE,IAAI,CAAC,CACxBR,aAAa,CAACM,QAAQ,CAACE,IAAI,CAACC,GAAG,CAAC,IAAM,CAAC,CAAC,CAAC,CAC3C,CAAE,MAAOC,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,yBAAyB,CAAEA,KAAK,CAAC,CACjD,CACF,CAAC,CAEDL,WAAW,CAAC,CAAC,CACf,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAO,SAAS,CAAIC,UAAU,EAAK,CAChC,KAAM,CAAAC,KAAK,CAAGjB,MAAM,CAACgB,UAAU,CAAC,CAChC,GAAI,CAAA1B,IAAI,CAAGC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,EAAI,EAAE,CACzD,GAAI,CAAAwB,SAAS,CAAG5B,IAAI,CAAC6B,SAAS,CAACtB,IAAI,EAAIA,IAAI,CAACuB,EAAE,GAAKH,KAAK,CAACG,EAAE,CAAC,CAE5D,GAAIF,SAAS,GAAK,CAAC,CAAC,CAAE,CACpB5B,IAAI,CAAC4B,SAAS,CAAC,CAACpB,QAAQ,EAAII,UAAU,CAACc,UAAU,CAAC,CACpD,CAAC,IAAM,CACL1B,IAAI,CAAC+B,IAAI,CAAC,CAAE,GAAGJ,KAAK,CAAEnB,QAAQ,CAAEI,UAAU,CAACc,UAAU,CAAE,CAAC,CAAC,CAC3D,CAEAvB,YAAY,CAAC6B,OAAO,CAAC,MAAM,CAAE/B,IAAI,CAACgC,SAAS,CAACjC,IAAI,CAAC,CAAC,CAClDe,YAAY,CAAC,IAAI,CAAC,CAClBE,gBAAgB,CAAClB,gBAAgB,CAAC,CAAC,CAAC,CACpCmC,UAAU,CAAC,IAAM,CACjBnB,YAAY,CAAC,KAAK,CAAC,CACnB,CAAC,CAAE,IAAI,CAAC,CACV,CAAC,CAED,KAAM,CAAAoB,oBAAoB,CAAGA,CAACT,UAAU,CAAEU,WAAW,GAAK,CAExDA,WAAW,CAAGC,IAAI,CAACC,GAAG,CAACD,IAAI,CAACE,GAAG,CAACH,WAAW,CAAE,CAAC,CAAC,CAAE,CAAC,CAAC,CAGnDvB,aAAa,CAAC2B,cAAc,EAAI,CAC9B,KAAM,CAAAC,aAAa,CAAG,CAAC,GAAGD,cAAc,CAAC,CACzCC,aAAa,CAACf,UAAU,CAAC,CAAGU,WAAW,CACvC,MAAO,CAAAK,aAAa,CACtB,CAAC,CAAC,CACJ,CAAC,CAED;AACC;AACD;AAEA,mBACE3C,KAAA,QAAK4C,SAAS,CAAC,qBAAqB,CAAAC,QAAA,eAClC/C,IAAA,CAACH,UAAU,EAACuB,aAAa,CAAEA,aAAc,CAAC4B,WAAW,CAAC,OAAO,CAAE,CAAC,cAChE9C,KAAA,QAAK4C,SAAS,CAAC,eAAe,CAAAC,QAAA,eAC5B/C,IAAA,OAAI8C,SAAS,CAAC,aAAa,CAAAC,QAAA,CAAC,cAAY,CAAI,CAAC,cAC7C/C,IAAA,QAAK8C,SAAS,CAAC,iBAAiB,CAAAC,QAAA,CAC7BjC,MAAM,CAACY,GAAG,CAAC,CAACK,KAAK,CAAEkB,KAAK,gBACvBjD,IAAA,QAAK8C,SAAS,CAAC,YAAY,CAAAC,QAAA,cACzB7C,KAAA,QAAK4C,SAAS,CAAC,oBAAoB,CAAAC,QAAA,eACjC7C,KAAA,QAAK4C,SAAS,CAAC,yBAAyB,CAAAC,QAAA,eACtC/C,IAAA,OAAA+C,QAAA,CAAKhB,KAAK,CAACmB,KAAK,CAAK,CAAC,cACtBlD,IAAA,MAAG8C,SAAS,CAAC,mBAAmB,CAAAC,QAAA,CAAEhB,KAAK,CAACoB,WAAW,CAAI,CAAC,EACrD,CAAC,cACNnD,IAAA,QAAK8C,SAAS,CAAC,eAAe,CAAM,CAAC,cACrC5C,KAAA,QAAK4C,SAAS,CAAC,sBAAsB,CAAAC,QAAA,eACnC7C,KAAA,MAAG4C,SAAS,CAAC,aAAa,CAAAC,QAAA,EAAEK,UAAU,CAACrB,KAAK,CAACsB,KAAK,CAAC,CAACC,OAAO,CAAC,CAAC,CAAC,CAAC,QAAC,EAAG,CAAC,cACpEpD,KAAA,QAAK4C,SAAS,CAAC,2BAA2B,CAAAC,QAAA,eACxC/C,IAAA,WAAQ8C,SAAS,CAAC,UAAU,CAACS,OAAO,CAAEA,CAAA,GAAMhB,oBAAoB,CAACU,KAAK,CAAEjC,UAAU,CAACiC,KAAK,CAAC,CAAG,CAAC,CAAE,CAAAF,QAAA,CAAC,GAAC,CAAQ,CAAC,cAC1G/C,IAAA,UACEwD,IAAI,CAAC,QAAQ,CACbC,KAAK,CAAEzC,UAAU,CAACiC,KAAK,CAAE,CACzBS,QAAQ,CAAGC,CAAC,EAAKpB,oBAAoB,CAACU,KAAK,CAAEW,QAAQ,CAACD,CAAC,CAACE,MAAM,CAACJ,KAAK,CAAC,CAAE,CACxE,CAAC,cACFzD,IAAA,WAAQ8C,SAAS,CAAC,KAAK,CAACS,OAAO,CAAEA,CAAA,GAAMhB,oBAAoB,CAACU,KAAK,CAAEjC,UAAU,CAACiC,KAAK,CAAC,CAAG,CAAC,CAAE,CAAAF,QAAA,CAAC,GAAC,CAAQ,CAAC,EAClG,CAAC,cACN/C,IAAA,WAAQ8C,SAAS,CAAC,eAAe,CAACS,OAAO,CAAEA,CAAA,GAAM1B,SAAS,CAACoB,KAAK,CAAE,CAACa,QAAQ,CAAE9C,UAAU,CAACiC,KAAK,CAAC,GAAK,CAAE,CAAAF,QAAA,CAAC,gBAAc,CAAQ,CAAC,EAC1H,CAAC,EACH,CAAC,EApByBhB,KAAK,CAACG,EAqBlC,CACN,CAAC,CACC,CAAC,CACLhB,SAAS,eAAIlB,IAAA,CAAC+D,KAAK,EAACC,OAAO,CAAC,wCAAwC,CAAE,CAAC,EACrE,CAAC,cACNhE,IAAA,CAACF,UAAU,GAAE,CAAC,EACX,CAAC,CAEV,CAAC,CAED,KAAM,CAAAiE,KAAK,CAAGE,IAAA,EAAiB,IAAhB,CAAED,OAAQ,CAAC,CAAAC,IAAA,CACxBvE,SAAS,CAAC,IAAM,CACd,KAAM,CAAAwE,IAAI,CAAGC,QAAQ,CAACC,aAAa,CAAC,iBAAiB,CAAC,CACtDF,IAAI,CAACG,SAAS,CAACC,GAAG,CAAC,SAAS,CAAC,CAE7BhC,UAAU,CAAC,IAAM,CACf4B,IAAI,CAACG,SAAS,CAACE,MAAM,CAAC,SAAS,CAAC,CAClC,CAAC,CAAE,IAAI,CAAC,CAER,MAAO,IAAM,CACXL,IAAI,CAACG,SAAS,CAACE,MAAM,CAAC,SAAS,CAAC,CAClC,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN,mBACErE,KAAA,QAAK4C,SAAS,CAAC,OAAO,CAAAC,QAAA,eACpB/C,IAAA,MAAA+C,QAAA,CAAIiB,OAAO,CAAI,CAAC,cAChBhE,IAAA,QACEwE,GAAG,CAAE5E,SAAU,CACf6E,GAAG,CAAC,WAAW,CACf3B,SAAS,CAAC,gBAAgB,CAC1B4B,KAAK,CAAE,CAAEC,iBAAiB,CAAE,IAAK,CAAE,CACpC,CAAC,EACC,CAAC,CAEV,CAAC,CAED,cAAe,CAAA9D,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}