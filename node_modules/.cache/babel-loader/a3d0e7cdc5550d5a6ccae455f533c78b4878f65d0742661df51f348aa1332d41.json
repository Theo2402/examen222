{"ast":null,"code":"import React,{useState,useEffect}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';import{useAuth}from'../contexts/AuthContext';import'../css/LoginPage.css';import{HeaderBase,FooterBase}from\"./HeaderFooter\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const getTotalQuantity=()=>{const cart=JSON.parse(localStorage.getItem('cart'))||[];return cart.reduce((acc,item)=>acc+item.quantity,0);};const LoginPage=()=>{const navigate=useNavigate();const{login}=useAuth();const[username,setUsername]=useState('');const[password,setPassword]=useState('');const[loading,setLoading]=useState(false);const[signInError,setSignInError]=useState('');const[totalQuantity,setTotalQuantity]=useState(getTotalQuantity());useEffect(()=>{setTotalQuantity(getTotalQuantity());},[]);const handleLogin=async()=>{setLoading(true);setSignInError('');try{const response=await axios.post('http://127.0.0.1:8000/api/token/',{username,password});const accessToken=response.data.access;const refreshToken=response.data.refresh;localStorage.setItem('access_token',accessToken);localStorage.setItem('refresh_token',refreshToken);const decodedToken=parseJwt(accessToken);if(decodedToken){login({username,is_admin:decodedToken.is_admin});navigate(decodedToken.is_admin?'/admin':'/profile');}else{console.error('Invalid token');}}catch(error){console.error('Login failed:',error);setSignInError('Echec de connexion. Veuillez réessayer');}setLoading(false);};function parseJwt(token){try{const base64Url=token.split('.')[1];const base64=base64Url.replace(/-/g,'+').replace(/_/g,'/');const jsonPayload=decodeURIComponent(atob(base64).split('').map(c=>{return'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);}).join(''));return JSON.parse(jsonPayload);}catch(e){console.error('Failed to parse JWT:',e);return null;}}return/*#__PURE__*/_jsxs(\"div\",{className:\"wrapper\",children:[/*#__PURE__*/_jsx(HeaderBase,{totalQuantity:totalQuantity,currentPage:\"login\"}),/*#__PURE__*/_jsx(\"div\",{className:\"main-content\",children:/*#__PURE__*/_jsx(\"div\",{className:\"login-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Connection\"}),/*#__PURE__*/_jsx(\"div\",{className:\"input-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:username,onChange:e=>setUsername(e.target.value),placeholder:\"Username\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"input-group\",children:/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,onChange:e=>setPassword(e.target.value),placeholder:\"Mot de passe\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"button-container\",children:/*#__PURE__*/_jsx(\"button\",{onClick:handleLogin,disabled:loading||!username||!password,children:\"Se connecter\"})}),signInError&&/*#__PURE__*/_jsx(\"p\",{className:\"notification error\",children:signInError}),/*#__PURE__*/_jsx(\"div\",{className:\"sign-up-link\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"sign-up-text\",children:[\"Vous n'avez pas de compte ? \",/*#__PURE__*/_jsx(\"span\",{className:\"sign-up-link-text\",onClick:()=>navigate('/register'),children:\"Inscrivez-vous ici\"})]})})]})})}),/*#__PURE__*/_jsx(FooterBase,{})]});};export default LoginPage;","map":{"version":3,"names":["React","useState","useEffect","axios","useNavigate","useAuth","HeaderBase","FooterBase","jsx","_jsx","jsxs","_jsxs","getTotalQuantity","cart","JSON","parse","localStorage","getItem","reduce","acc","item","quantity","LoginPage","navigate","login","username","setUsername","password","setPassword","loading","setLoading","signInError","setSignInError","totalQuantity","setTotalQuantity","handleLogin","response","post","accessToken","data","access","refreshToken","refresh","setItem","decodedToken","parseJwt","is_admin","console","error","token","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","e","className","children","currentPage","type","value","onChange","target","placeholder","onClick","disabled"],"sources":["/Users/theodiloreto/Desktop/examen 2 2 2/jo/src/components/LoginPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuth } from '../contexts/AuthContext';\nimport '../css/LoginPage.css';\nimport { HeaderBase, FooterBase } from \"./HeaderFooter\";\n\nconst getTotalQuantity = () => {\n  const cart = JSON.parse(localStorage.getItem('cart')) || [];\n  return cart.reduce((acc, item) => acc + item.quantity, 0);\n};\n\nconst LoginPage = () => {\n  const navigate = useNavigate();\n  const { login } = useAuth();\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [signInError, setSignInError] = useState('');\n  const [totalQuantity, setTotalQuantity] = useState(getTotalQuantity());\n\n  useEffect(() => {\n    setTotalQuantity(getTotalQuantity());\n  }, []);\n\n  const handleLogin = async () => {\n    setLoading(true);\n    setSignInError('');\n    try {\n      const response = await axios.post('http://127.0.0.1:8000/api/token/', { username, password });\n      const accessToken = response.data.access;\n      const refreshToken = response.data.refresh;\n\n      localStorage.setItem('access_token', accessToken);\n      localStorage.setItem('refresh_token', refreshToken);\n\n      const decodedToken = parseJwt(accessToken);\n      if (decodedToken) {\n        login({ username, is_admin: decodedToken.is_admin });\n        navigate(decodedToken.is_admin ? '/admin' : '/profile');\n      } else {\n        console.error('Invalid token');\n      }\n    } catch (error) {\n      console.error('Login failed:', error);\n      setSignInError('Echec de connexion. Veuillez réessayer');\n    }\n    setLoading(false);\n  };\n\n  function parseJwt(token) {\n    try {\n      const base64Url = token.split('.')[1];\n      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n      const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {\n        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n      }).join(''));\n      return JSON.parse(jsonPayload);\n    } catch (e) {\n      console.error('Failed to parse JWT:', e);\n      return null;\n    }\n  }\n\n  return (\n    <div className=\"wrapper\">\n      <HeaderBase totalQuantity={totalQuantity} currentPage=\"login\" />\n      <div className=\"main-content\">\n        <div className=\"login-container\">\n          <div className=\"card\">\n            <h1>Connection</h1>\n            <div className=\"input-group\">\n              <input\n                type=\"text\"\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                placeholder=\"Username\"\n              />\n            </div>\n            <div className=\"input-group\">\n              <input\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                placeholder=\"Mot de passe\"\n              />\n            </div>\n            <div className=\"button-container\">\n              <button onClick={handleLogin} disabled={loading || !username || !password}>Se connecter</button>\n            </div>\n            {signInError && <p className=\"notification error\">{signInError}</p>}\n            <div className=\"sign-up-link\">\n              <p className=\"sign-up-text\">\n                Vous n'avez pas de compte ? <span className=\"sign-up-link-text\" onClick={() => navigate('/register')}>Inscrivez-vous ici</span>\n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n      <FooterBase />\n    </div>\n  );\n};\n\nexport default LoginPage;\n\n\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}