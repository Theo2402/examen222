{"ast":null,"code":"import React,{useState,useEffect}from'react';import axios from'axios';import'../css/Cart.css';import{HeaderBase,FooterBase}from\"./HeaderFooter\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const getTotalQuantity=()=>{const cart=JSON.parse(localStorage.getItem('cart'))||[];return cart.reduce((acc,item)=>acc+item.quantity,0);};const Cart=()=>{const[cartItems,setCartItems]=useState([]);const[message,setMessage]=useState('');const[totalQuantity,setTotalQuantity]=useState(getTotalQuantity());useEffect(()=>{const loadedCartItems=JSON.parse(localStorage.getItem('cart'))||[];setCartItems(loadedCartItems);setTotalQuantity(getTotalQuantity());},[]);const removeFromCart=offerId=>{const updatedCartItems=cartItems.filter(item=>item.id!==offerId);setCartItems(updatedCartItems);localStorage.setItem('cart',JSON.stringify(updatedCartItems));setTotalQuantity(getTotalQuantity());};const checkout=async()=>{const token=localStorage.getItem('access_token');if(!token){setMessage('Please log in to complete your purchase.');return;}try{const payload=cartItems.map(item=>({id:item.id}));//console.log(\"Payload being sent:\", payload); \n//console.log(\"Access Token:\", token);\nconst response=await axios.post('http://127.0.0.1:8000/api/purchase/purchase/',payload,{headers:{'Authorization':\"Bearer \".concat(token)}});console.log(\"Checkout response:\",response.data);setMessage('Purchase successful!');setCartItems([]);localStorage.removeItem('cart');setTotalQuantity(0);// Reset quantite apres le paiement\n}catch(error){console.error('Error during checkout:',error.response?error.response.data:error);setMessage('Checkout failed. Please try again.');}};const totalPrice=cartItems.reduce((total,item)=>total+parseFloat(item.price),0).toFixed(2);return/*#__PURE__*/_jsxs(\"div\",{id:\"root\",children:[/*#__PURE__*/_jsx(HeaderBase,{totalQuantity:totalQuantity,currentPage:\"cart\"}),/*#__PURE__*/_jsx(\"div\",{className:\"main-content\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"cart-page\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Panier\"}),message&&/*#__PURE__*/_jsx(\"p\",{children:message}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Vous avez \",cartItems.length,\" objets dans votre panier.\"]}),cartItems.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"Votre panier est vide.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"cart-items\",children:cartItems.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"cart-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"item-info\",children:[/*#__PURE__*/_jsx(\"img\",{src:item.image,alt:item.title,className:\"item-image\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{children:item.title}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Description: \",item.description]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-controls\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeFromCart(item.id),children:\"\\u2715\"}),/*#__PURE__*/_jsxs(\"p\",{children:[parseFloat(item.price).toFixed(2),\"\\u20AC\"]})]})]},item.id))}),cartItems.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"cart-summary\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"summary-item\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Sous-total\"}),/*#__PURE__*/_jsxs(\"span\",{children:[totalPrice,\"\\u20AC\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"summary-item\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Total\"}),/*#__PURE__*/_jsxs(\"span\",{children:[totalPrice,\"\\u20AC\"]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:checkout,children:\"Acheter\"})]})]})}),/*#__PURE__*/_jsx(FooterBase,{})]});};export default Cart;","map":{"version":3,"names":["React","useState","useEffect","axios","HeaderBase","FooterBase","jsx","_jsx","jsxs","_jsxs","getTotalQuantity","cart","JSON","parse","localStorage","getItem","reduce","acc","item","quantity","Cart","cartItems","setCartItems","message","setMessage","totalQuantity","setTotalQuantity","loadedCartItems","removeFromCart","offerId","updatedCartItems","filter","id","setItem","stringify","checkout","token","payload","map","response","post","headers","concat","console","log","data","removeItem","error","totalPrice","total","parseFloat","price","toFixed","children","currentPage","className","length","src","image","alt","title","description","onClick"],"sources":["/Users/theodiloreto/Desktop/examen 5 3/jo/src/components/Cart.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport '../css/Cart.css';\nimport { HeaderBase, FooterBase } from \"./HeaderFooter\";\n\nconst getTotalQuantity = () => {\n  const cart = JSON.parse(localStorage.getItem('cart')) || [];\n  return cart.reduce((acc, item) => acc + item.quantity, 0);\n};\n\nconst Cart = () => {\n  const [cartItems, setCartItems] = useState([]);\n  const [message, setMessage] = useState('');\n  const [totalQuantity, setTotalQuantity] = useState(getTotalQuantity());\n\n  useEffect(() => {\n    const loadedCartItems = JSON.parse(localStorage.getItem('cart')) || [];\n    setCartItems(loadedCartItems);\n    setTotalQuantity(getTotalQuantity()); \n  }, []);\n\n  const removeFromCart = (offerId) => {\n    const updatedCartItems = cartItems.filter(item => item.id !== offerId);\n    setCartItems(updatedCartItems);\n    localStorage.setItem('cart', JSON.stringify(updatedCartItems));\n    setTotalQuantity(getTotalQuantity()); \n  };\n\n  const checkout = async () => {\n    const token = localStorage.getItem('access_token');\n    if (!token) {\n      setMessage('Please log in to complete your purchase.');\n      return;\n    }\n\n    try {\n      const payload = cartItems.map(item => ({ id: item.id }));\n      //console.log(\"Payload being sent:\", payload); \n      //console.log(\"Access Token:\", token);\n\n      const response = await axios.post('http://127.0.0.1:8000/api/purchase/purchase/', payload, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      console.log(\"Checkout response:\", response.data); \n      setMessage('Purchase successful!');\n      setCartItems([]);\n      localStorage.removeItem('cart');\n      setTotalQuantity(0); // Reset quantite apres le paiement\n    } catch (error) {\n      console.error('Error during checkout:', error.response ? error.response.data : error);\n      setMessage('Checkout failed. Please try again.');\n    }\n  };\n\n  const totalPrice = cartItems.reduce((total, item) => total + parseFloat(item.price), 0).toFixed(2);\n\n  return (\n    <div id=\"root\">\n      <HeaderBase totalQuantity={totalQuantity} currentPage=\"cart\" />\n      <div className=\"main-content\">\n        <div className=\"cart-page\">\n          <h1>Panier</h1>\n          {message && <p>{message}</p>}\n          <p>Vous avez {cartItems.length} objets dans votre panier.</p>\n          {cartItems.length === 0 ? (\n            <p>Votre panier est vide.</p>\n          ) : (\n            <div className=\"cart-items\">\n              {cartItems.map(item => (\n                <div key={item.id} className=\"cart-item\">\n                  <div className=\"item-info\">\n                    <img src={item.image} alt={item.title} className=\"item-image\" />\n                    <div>\n                      <h4>{item.title}</h4>\n                      <p>Description: {item.description}</p>\n                    </div>\n                  </div>\n                  <div className=\"item-controls\">\n                    <button onClick={() => removeFromCart(item.id)}>✕</button>\n                    <p>{parseFloat(item.price).toFixed(2)}€</p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n          {cartItems.length > 0 && (\n            <div className=\"cart-summary\">\n              <div className=\"summary-item\">\n                <span>Sous-total</span>\n                <span>{totalPrice}€</span>\n              </div>\n              <div className=\"summary-item\">\n                <span>Total</span>\n                <span>{totalPrice}€</span>\n              </div>\n              <button onClick={checkout}>Acheter</button>\n            </div>\n          )}\n        </div>\n      </div>\n      <FooterBase />\n    </div>\n  );\n};\n\nexport default Cart;\n\n\n\n\n\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}